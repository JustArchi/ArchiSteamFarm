<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ArchiSteamFarm | Bots</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-sweetalert/1.0.1/sweetalert.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/2.4.2/css/AdminLTE.min.css">
    <link rel="stylesheet" href="../css/_all-skins.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <!--Change font-awesome to cdnjs once available-->
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
    <link rel="stylesheet" href="../css/app.css">
    <link rel="stylesheet" href="../css/_nightmode.min.css">
    <link rel="icon" href="../favicon.png" type="image/png">
    <link rel="shortcut icon" href="../favicon.ico" type="img/x-icon">
</head>
<body class="hold-transition skin-blue sidebar-mini fixed">
    <div class="wrapper">
        <header class="main-header">
            <!-- Logo -->
            <a href="javascript:void(0)" class="logo">
                <span class="logo-mini"><b>A</b>SF</span>
                <span class="logo-lg"><b>Archi</b>SteamFarm</span>
            </a>

            <!-- Header -->
            <nav class="navbar navbar-static-top" role="navigation">
                <!-- Left Sidebar Toggle Button-->
                <a href="javascript:void(0)" class="sidebar-toggle" id="leftSidebar" data-toggle="push-menu" role="button">
                    <i class="fas fa-bars"></i>
                    <span class="sr-only">Toggle navigation</span>
                </a>
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <!-- Right Sidebar Toggle Button -->
                        <li><a href="javascript:void(0)" data-toggle="control-sidebar"><i class="fas fa-cogs"></i></a></li>
                    </ul>
                </div>
            </nav>
        </header>
        <!-- Left Sidebar -->
        <aside class="main-sidebar">
            <section class="sidebar">
                <ul class="sidebar-menu" data-widget="tree">
                    <li class="header">HOME</li>
                    <li><a href="command.html"><i class="fas fa-laptop fa-fw"></i> <span>Command</span></a></li>
                    <li class="active">
                        <a href="bots.html">
                            <i class="fas fa-users fa-fw"></i> <span>Bots</span>
                            <span class="pull-right-container bot-status">
                                <small class="label pull-right bg-gray" id="offlineBots">0</small>
                                <small class="label pull-right bg-yellow" id="idleBots">0</small>
                                <small class="label pull-right bg-olive" id="activeBots">0</small>
                            </span>
                        </a>
                    </li>
                    <li><a href="log.html"><i class="far fa-file-alt fa-fw"></i> <span>Log</span></a></li>
                    <li><a href="config.html"><i class="fas fa-cogs fa-fw"></i> <span>Config</span></a></li>

                    <li class="header">INFORMATION</li>
                    <li class="info-overview">
                        <a>
                            <i class="fas fa-tachometer-alt fa-fw"></i> <span>RAM Usage</span>
                            <span class="pull-right-container">
                                <small class="label pull-right bg-blue" id="ramUsage">0.00 MB</small>
                            </span>
                        </a>
                    </li>
                    <li class="info-overview">
                        <a>
                            <i class="far fa-clock fa-fw"></i> <span>Uptime</span>
                            <span class="pull-right-container">
                                <small class="label pull-right bg-blue" id="uptime">0d 0h 0m</small>
                            </span>
                        </a>
                    </li>
                </ul>
            </section>
        </aside>

        <div class="content-wrapper">
            <!-- Content Header -->
            <section class="content-header">
                <h1>
                    Bots
                    <small>Control Panel</small>
                </h1>
                <ol class="breadcrumb">
                    <li><i class="fas fa-home"></i> Home</li>
                    <li class="active"><i class="fas fa-users"></i> Bots</li>
                </ol>
            </section>

            <!-- Content Body -->
            <section class="content container-fluid">
                <div class="box collapsed-box" id="headerBox">
                    <div class="box-header">
                        <i class="fas fa-users"></i>

                        <h3 class="box-title">Bots</h3>
                        <div class="box-tools pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown">
                                    Hide bots <span class="fas fa-caret-down"></span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><button title="Toggle online bots" type="button" class="btn btn-box-tool text-grey" id="chkHideOnlineBots"><i id="iconHideOnlineBots" class="fas fa-toggle-on fa-2x fa-rotate-180"></i></button>Online bots</li>
                                    <li><button title="Toggle offline bots" type="button" class="btn btn-box-tool text-grey" id="chkHideOfflineBots"><i id="iconHideOfflineBots" class="fas fa-toggle-on fa-2x fa-rotate-180"></i></button>Offline bots</li>
                                </ul>
                            </div>
                            <button title="Toggle multi select" type="button" class="btn btn-box-tool" id="chkMultiSelect" data-widget="collapse"><i id="iconMultiSelect" class="far fa-square"></i></button>
                            <button type="button" class="btn btn-box-tool" id="btnRefreshContent"><i class="fas fa-sync"></i></button>
                            <div class="btn-group">
                                <button type="button" class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown">
                                    <i class="fas fa-wrench"></i>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><button title="Toggle key button" type="button" class="btn btn-box-tool text-grey" id="chkShowKeyButton"><i id="iconShowKeyButton" class="fas fa-toggle-on fa-2x fa-rotate-180"></i></button>Show key button</li>
                                    <li><button title="Toggle delete button" type="button" class="btn btn-box-tool text-grey" id="chkShowDeleteButton"><i id="iconShowDeleteButton" class="fas fa-toggle-on fa-2x fa-rotate-180"></i></button>Show delete button</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="box-body">
                        <button title="Select all bots" type="button" class="btn btn-default" id="selectAllBots"><i class="fas fa-th"></i> Select all</button>
                        <button title="Deselect all bots" type="button" class="btn btn-default" id="deselectAllBots"><i class="fas fa-th"></i> Deselect all</button>
                    </div>
                </div>
                <div class="row" id="totalBotOverview"></div>
                <div class="row" id="botRow"></div>
            </section>
        </div>

        <!-- Footer -->
        <footer class="main-footer">
            <div class="pull-right" id="version"><b>Version</b> 0.0.0.0</div>
            <strong>
                <a href="https://github.com/JustArchi/ArchiSteamFarm">GitHub</a> -
                <a href="https://github.com/JustArchi/ArchiSteamFarm/wiki">Wiki</a> -
                <a href="https://github.com/JustArchi/ArchiSteamFarm/commits/master" id="changelog">Changelog</a>
            </strong>
        </footer>

        <!-- Right Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <div class="tab-content">
                <div class="tab-pane" id="control-right-sidebar"></div>
            </div>
        </aside>

        <div class="control-sidebar-bg"></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-sweetalert/1.0.1/sweetalert.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/2.4.2/js/adminlte.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/humanize-duration/3.12.1/humanize-duration.min.js"></script>
    <script src="../js/app.js"></script>
    <script>
        $(function () {
            'use strict';

            var tmpHideOnlineBots = get('hideOnlineBots'),
                tmpHideOfflineBots = get('hideOfflineBots'),
                tmpShowDeleteButton = get('showDeleteButton'),
                tmpShowKeyButton = get('showKeyButton'),
                tmpMultiSelect = get('multiSelect'),
                currentlySelectedBots = [];

            $(document).delegate('#gamesToRedeemInBackground', 'keydown', function (e) {
                var keyCode = e.keyCode || e.which;

                if (keyCode == 9) {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    var start = this.selectionStart;
                    var end = this.selectionEnd;
                    
                    $(this).val($(this).val().substring(0, start) // set textarea value to: text before caret + tab + text after caret
                        + "\t"
                        + $(this).val().substring(end));
                    
                    this.selectionStart = this.selectionEnd = start + 1; // put caret at right position again
                }
            });

            $(document).delegate('#delimeter', 'keydown', function (e) {
                var keyCode = e.keyCode || e.which;

                if (keyCode == 9) {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    var start = this.selectionStart;
                    var end = this.selectionEnd;
                    
                    $(this).val($(this).val().substring(0, start) // set textarea value to: text before caret + tab + text after caret
                        + "\t"
                        + $(this).val().substring(end));
                    
                    this.selectionStart = this.selectionEnd = start + 1; // put caret at right position again
                }
            });
            
            $('.box-tools').ready(function () { // Load state of checkboxes
                if (tmpHideOnlineBots === 'true') {
                    $('#chkHideOnlineBots').removeClass('text-grey');
                    $('#chkHideOnlineBots').addClass('text-olive');
                    $('#iconHideOnlineBots').removeClass('fa-rotate-180');
                }

                if (tmpHideOfflineBots === 'true') {
                    $('#chkHideOfflineBots').removeClass('text-grey');
                    $('#chkHideOfflineBots').addClass('text-olive');
                    $('#iconHideOfflineBots').removeClass('fa-rotate-180');
                }

                if (tmpHideOnlineBots !== 'true' || tmpHideOfflineBots !== 'true') loadPageContent();

                if (tmpShowDeleteButton === 'true') {
                    $('#chkShowDeleteButton').removeClass('text-grey');
                    $('#chkShowDeleteButton').addClass('text-olive');
                    $('#iconShowDeleteButton').removeClass('fa-rotate-180');
                }

                if (tmpShowKeyButton === 'true') {
                    $('#chkShowKeyButton').removeClass('text-grey');
                    $('#chkShowKeyButton').addClass('text-olive');
                    $('#iconShowKeyButton').removeClass('fa-rotate-180');
                }

                if (tmpMultiSelect === 'true') {
                    $('#iconMultiSelect').removeClass('fa-square');
                    $('#iconMultiSelect').addClass('fa-check-square');
                    $('#headerBox').removeClass('collapsed-box');
                    $('#headerBox').removeClass('expanded-box');
                    $('#botRow').selectable({
                        //stop: function () {
                        //    //$(".ui-selected", this).each(function () {
                        //    //    var index = $("#selectable li").index(this);
                        //    //    result.append(" #" + (index + 1));
                        //    //});
                        //},
                        //selecting: function (event, ui) {
                        //    //$(ui.selecting).addClass('box-solid');
                        //},
                        //unselecting: function (event, ui) {
                        //    //$(ui.unselecting).removeClass('box-solid');
                        //},
                        //selected: function (event, ui) {
                        //    //$(ui.selected).addClass('box-solid');
                        //},
                        //unselected: function (event, ui) {
                        //    //$(ui.unselected).removeClass('box-solid');
                        //}
                    });
                }
            });

            $('#chkHideOnlineBots').click(function () {
                if ($('#iconHideOnlineBots').hasClass('fa-rotate-180')) {
                    $('#iconHideOnlineBots').removeClass('fa-rotate-180');
                    $('#chkHideOnlineBots').removeClass('text-grey');
                    $('#chkHideOnlineBots').addClass('text-olive');
                    store('hideOnlineBots', true);
                } else {
                    $('#iconHideOnlineBots').addClass('fa-rotate-180');
                    $('#chkHideOnlineBots').removeClass('text-olive');
                    $('#chkHideOnlineBots').addClass('text-grey');
                    store('hideOnlineBots', false);
                }
                loadPageContent();
            });

            $('#chkHideOfflineBots').click(function () {
                if ($('#iconHideOfflineBots').hasClass('fa-rotate-180')) {
                    $('#iconHideOfflineBots').removeClass('fa-rotate-180');
                    $('#chkHideOfflineBots').removeClass('text-grey');
                    $('#chkHideOfflineBots').addClass('text-olive');
                    store('hideOfflineBots', true);
                } else {
                    $('#iconHideOfflineBots').addClass('fa-rotate-180');
                    $('#chkHideOfflineBots').removeClass('text-olive');
                    $('#chkHideOfflineBots').addClass('text-grey');
                    store('hideOfflineBots', false);
                }
                loadPageContent();
            });

            $('#chkMultiSelect').click(function () {
                if ($('#iconMultiSelect').hasClass('fa-square')) {
                    $('#iconMultiSelect').removeClass('fa-square');
                    $('#iconMultiSelect').addClass('fa-check-square');
                    $('#botRow').selectable();
                    store('multiSelect', true);
                } else {
                    $('#iconMultiSelect').removeClass('fa-check-square');
                    $('#iconMultiSelect').addClass('fa-square');
                    $('#botRow').selectable('destroy');
                    store('multiSelect', false);
                }
                $('#chkMultiSelect').blur();
            });

            $('#selectAllBots').click(function () {
                $(".ui-widget-content").each(function () {
                    $(this).addClass('ui-selected');
                });
            });

            $('#deselectAllBots').click(function () {
                $(".ui-selectee").each(function () {
                    $(this).removeClass('ui-selected');
                });
            });

            $('#btnRefreshContent').click(function () {
                $('#btnRefreshContent').blur();
                loadPageContent();
            });

            $('#chkShowDeleteButton').click(function () {
                if ($('#iconShowDeleteButton').hasClass('fa-rotate-180')) {
                    $('#iconShowDeleteButton').removeClass('fa-rotate-180');
                    $('#chkShowDeleteButton').removeClass('text-grey');
                    $('#chkShowDeleteButton').addClass('text-olive');
                    store('showDeleteButton', true);
                } else {
                    $('#iconShowDeleteButton').addClass('fa-rotate-180');
                    $('#chkShowDeleteButton').removeClass('text-olive');
                    $('#chkShowDeleteButton').addClass('text-grey');
                    store('showDeleteButton', false);
                }
                loadPageContent();
            });

            $('#chkShowKeyButton').click(function () {
                if ($('#iconShowKeyButton').hasClass('fa-rotate-180')) {
                    $('#iconShowKeyButton').removeClass('fa-rotate-180');
                    $('#chkShowKeyButton').removeClass('text-grey');
                    $('#chkShowKeyButton').addClass('text-olive');
                    store('showKeyButton', true);
                } else {
                    $('#iconShowKeyButton').addClass('fa-rotate-180');
                    $('#chkShowKeyButton').removeClass('text-olive');
                    $('#chkShowKeyButton').addClass('text-grey');
                    store('showKeyButton', false);
                }
                loadPageContent();
            });

            function loadPageContent() {
                var tmpHideOnlineBots = get('hideOnlineBots'),
                    tmpHideOfflineBots = get('hideOfflineBots'),
                    tmpShowDeleteButton = get('showDeleteButton'),
                    tmpDelimeter = get('delimeter'),
                    tmpShowKeyButton = get('showKeyButton');
                
                $('#totalBotOverview').empty(); // Clear page content
                $('#botRow').empty(); // Clear page content

                if (!tmpDelimeter) {
                    tmpDelimeter = '\t';
                }

                $.ajax({
                    url: '/Api/Bot/ASF',
                    type: 'GET',
                    success: function (data) {
                        var json = data['Result'],
                            steamAvatarBaseURL = 'https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/',
                            steamGameBaseURL = 'http://cdn.edgecast.steamstatic.com/steam/apps/',
                            totalGamesRemaining = 0,
                            totalTimeRemaining = '00:00:00',
                            totalCardsRemaining = 0,
                            farmingIsActive = false;

                        var deleteBotHTML = tmpShowDeleteButton === 'true' ? '<button title="Delete this bot" type="button" class="btn btn-box-tool" data-command="deleteBot"><i class="far fa-trash-alt"></i></button>' : '';
                        var redeemGamesHTML = tmpShowKeyButton === 'true' ? '<button title="Add keys to GamesToRedeemInBackground" type="button" class="btn btn-box-tool" data-command="redeemGames"><i class="fas fa-key"></i></button>' : '';

                        for (var i = 0; i < json.length; i++) {
                            var obj = json[i],
                                BotName = obj.BotName,
                                AvatarHash = obj.AvatarHash,
                                IsPlayingPossible = obj.IsPlayingPossible,
                                KeepRunning = obj.KeepRunning,
                                SteamID = obj.SteamID,
                                Paused = obj.CardsFarmer.Paused,
                                boxColorHTML = '',
                                avatarHTML = '',
                                startOrStopHTML = '',
                                pauseOrResumeHTML = '',
                                expandBoxHTML = '',
                                allGamesHTML = '',
                                boxBodyHTML = '';

                            if (AvatarHash) {
                                var folder = AvatarHash.substring(0, 2);
                                avatarHTML = steamAvatarBaseURL + folder + '/' + AvatarHash + '.jpg';
                            } else {
                                avatarHTML = steamAvatarBaseURL + 'fe/fef49e7fa7e1997310d705b2a6158ff8dc1cdfeb.jpg';
                            }

                            if (KeepRunning === false) { // Bot is offline
                                if (tmpHideOfflineBots === 'true') continue;
                                boxColorHTML = 'box-gray';
                                startOrStopHTML = '<button title="Start <' + BotName + '>" type="button" class="btn btn-box-tool bot-stopped" data-command="startBot"><i class="fas fa-power-off"></i></button>';
                            } else { // Bot is idling
                                if (tmpHideOnlineBots === 'true') continue;
                                boxColorHTML = 'box-warning';
                                startOrStopHTML = '<button title="Stop <' + BotName + '>" type="button" class="btn btn-box-tool bot-started" data-command="stopBot"><i class="fas fa-power-off"></i></button>';

                                var TimeRemaining = obj.CardsFarmer.TimeRemaining;

                                if (SteamID === 0) { // Bot is not connected to steam
                                    boxColorHTML = 'box-danger';
                                } else { // Bot is connected to steam
                                    if (TimeRemaining !== '00:00:00') { // Bot is farming
                                        var GamesToFarm = obj.CardsFarmer.GamesToFarm,
                                            CurrentGamesFarming = obj.CardsFarmer.CurrentGamesFarming,
                                            allGamesRemainingName = [],
                                            allGamesFarmingAppID = [],
                                            allCardsRemaining = 0;

                                        farmingIsActive = true; // At least one bot is farming
                                        boxColorHTML = 'box-success';

                                        for (var j = 0; j < GamesToFarm.length; j++) {
                                            totalCardsRemaining = totalCardsRemaining + GamesToFarm[j].CardsRemaining;
                                            allCardsRemaining = allCardsRemaining + GamesToFarm[j].CardsRemaining;
                                            allGamesRemainingName.push(GamesToFarm[j].GameName);
                                        }

                                        for (var k = 0; k < CurrentGamesFarming.length; k++) {
                                            allGamesFarmingAppID.push(CurrentGamesFarming[k].AppID);
                                        }

                                        if (totalTimeRemaining < TimeRemaining) totalTimeRemaining = TimeRemaining;

                                        totalGamesRemaining += GamesToFarm.length;

                                        expandBoxHTML = '<button title="Show more infos" type="button" class="btn btn-box-tool" data-widget="collapse" id="collapse-trigger"><i class="fas fa-plus"></i></button>'

                                        if (IsPlayingPossible) {
                                            if (Paused) {
                                                allGamesHTML = '<p class="text-center no-margin">Bot is paused.</p>';
                                            } else {
                                                if (allGamesFarmingAppID.length === 1) {
                                                    var value = allGamesFarmingAppID;
                                                    allGamesHTML = '<img src="' + steamGameBaseURL + value[0] + '/header.jpg" alt="" class="img-responsive">'; // ToDo: Fill alt="" with gameName
                                                } else { // Multiple game farming is active
                                                    allGamesHTML = '<div class="games-carousel-' + BotName + '">';

                                                    for (var appID in allGamesFarmingAppID) {
                                                        var value = allGamesFarmingAppID[appID];
                                                        allGamesHTML += '<div class="game-box" style="max-height: 215px;"><img src="' + steamGameBaseURL + value + '/header.jpg" alt="" class="img-responsive"></div>'; // ToDo: Fill alt="" with gameName
                                                    }

                                                    allGamesHTML += '</div>';
                                                }
                                            }
                                        } else {
                                            allGamesHTML = '<p class="text-center no-margin">Bot is currently being used.</p>';
                                        }

                                        TimeRemaining = new Date('1970-01-01T' + TimeRemaining + 'Z').getTime();

                                        boxBodyHTML = '<div class="box-body" id="' + BotName + '">'
                                            + '<div class="row">'
                                            + '<div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">'
                                            + '<span class="pull-left"><i class="far fa-clock"></i> ' + humanizeDuration(TimeRemaining) + '</span>'
                                            + '</div>'
                                            + '<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">'
                                            + '<span class="pull-right"><i class="far fa-clone"></i> ' + allCardsRemaining + '</span>'
                                            + '</div>'
                                            + '</div>'
                                            + allGamesHTML
                                            + '</div>'
                                    }
                                }

                                if (Paused) {
                                    pauseOrResumeHTML = '<button title="Resume <' + BotName + '>" type="button" class="btn btn-box-tool bot-paused" data-command="resumeBot"><i class="fas fa-pause"></i></button>';
                                } else {
                                    pauseOrResumeHTML = '<button title="Pause <' + BotName + '>" type="button" class="btn btn-box-tool bot-resumed" data-command="pauseBot"><i class="fas fa-pause"></i></button>';
                                }
                            }

                            $('#botRow').append('<div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">'
                                + '<div class="box ' + boxColorHTML + ' collapsed-box" id="bot-box-' + BotName + '">'
                                + '<div class="box-header with-border botHeader ui-widget-content">'
                                + '<img src="' + avatarHTML + '">'
                                + '<h3 class="box-title botTitle">' + BotName + '</h3>'
                                + '<div class="box-tools pull-right botTools" id="' + BotName + '">'
                                + startOrStopHTML
                                + pauseOrResumeHTML
                                + redeemGamesHTML
                                + deleteBotHTML
                                + expandBoxHTML
                                + '</div>'
                                + boxBodyHTML
                                + '</div>'
                                + '</div>'
                                + '</div>');

                            $('#bot-box-' + BotName).boxWidget({
                                animationSpeed: 500,
                                collapseTrigger: '#collapse-trigger',
                                collapseIcon: 'fa-minus',
                                expandIcon: 'fa-plus',
                            })
                                .on('expanded.boxwidget', function (BotName) {
                                    var botCarousel = $('.games-carousel-' + BotName);

                                    
                                    if ($(botCarousel).hasClass('slick-initialized')) { // Check if Slick was already initialized
                                        $(botCarousel).slick('slickPlay'); // Slick is set up, so just resume the animation
                                    } else {
                                        $(botCarousel).slick({ // Set up Slick for the first time.
                                            slidesToShow: 1,
                                            draggable: true,
                                            autoplay: true,
                                            autoplaySpeed: 2000,
                                            arrows: false,
                                            infinite: true
                                        });
                                    }
                                }.bind(null, BotName))
                                .on('collapsed.boxwidget', function (BotName) {
                                    $('.games-carousel-' + BotName).slick('slickPause'); // Pause Slick's animation and collapse the menu
                                }.bind(null, BotName)
                            );

                            $('#bot-box-' + BotName + ' .btn').click(function () {
                                var BotName = $(this).parent().attr('id'),
                                    cmd = $(this).data('command'),
                                    $botBox = $('#bot-box-' + BotName);

                                switch (cmd) {
                                    case 'startBot':
                                        $botBox.append('<div class="overlay bot-box-loading"><i class="fas fa-sync fa-spin"></i></div>');
                                        $.ajax({
                                            url: '/Api/Command/start ' + encodeURIComponent(BotName),
                                            type: 'GET',
                                            success: function (data) {
                                                $('.overlay').remove();
                                                swal({
                                                    title: 'Success!',
                                                    text: '<' + BotName + '> has been started.',
                                                    type: 'success'
                                                }, function () { location.reload(); });
                                            }
                                        });
                                        break;

                                    case 'stopBot':
                                        $botBox.append('<div class="overlay bot-box-loading"><i class="fas fa-sync fa-spin"></i></div>');
                                        $.ajax({
                                            url: '/Api/Command/stop ' + encodeURIComponent(BotName),
                                            type: 'GET',
                                            success: function (data) {
                                                $('.overlay').remove();
                                                swal({
                                                    title: 'Success!',
                                                    text: '<' + BotName + '> has been stopped.',
                                                    type: 'success'
                                                }, function () { location.reload(); });
                                            }
                                        });
                                        break;

                                    case 'pauseBot':
                                        $botBox.append('<div class="overlay bot-box-loading"><i class="fas fa-sync fa-spin"></i></div>');
                                        $.ajax({
                                            url: '/Api/Command/pause ' + encodeURIComponent(BotName),
                                            type: 'GET',
                                            success: function (data) {
                                                $('.overlay').remove();
                                                swal({
                                                    title: 'Success!',
                                                    text: '<' + BotName + '> has been paused.',
                                                    type: 'success'
                                                }, function () { location.reload(); });
                                            }
                                        });
                                        break;

                                    case 'resumeBot':
                                        $botBox.append('<div class="overlay bot-box-loading"><i class="fas fa-sync fa-spin"></i></div>');
                                        $.ajax({
                                            url: '/Api/Command/resume ' + encodeURIComponent(BotName),
                                            type: 'GET',
                                            success: function (data) {
                                                $('.overlay').remove();
                                                swal({
                                                    title: 'Success!',
                                                    text: '<' + BotName + '> has been resumed.',
                                                    type: 'success'
                                                }, function () { location.reload(); });
                                            }
                                        });
                                        break;

                                    case 'deleteBot':
                                        $botBox.append('<div class="overlay bot-box-loading"><i class="fas fa-sync fa-spin"></i></div>');
                                        swal({
                                            title: 'Are you sure?',
                                            text: 'You will not be able to recover any bot files!',
                                            type: 'warning',
                                            showCancelButton: true,
                                            confirmButtonClass: 'btn-danger',
                                            confirmButtonText: 'Yes, delete bot!',
                                            closeOnConfirm: false,
                                            showLoaderOnConfirm: true
                                        }, function (isConfirm) {
                                            if (isConfirm) {
                                                $.ajax({
                                                    url: '/Api/Bot/' + encodeURIComponent(BotName),
                                                    type: 'DELETE',
                                                    success: function (data) {
                                                        $('.overlay').remove();
                                                        swal({
                                                            title: 'Success!',
                                                            text: '<' + BotName + '> and all related files have been deleted.',
                                                            type: 'success'
                                                        }, function () { location.reload(); });
                                                    }
                                                });
                                            } else {
                                                $('.overlay').remove();
                                            }                                            
                                        });
                                        break;

                                    case 'redeemGames':
                                        $botBox.append('<div class="overlay bot-box-loading"><i class="fas fa-sync fa-spin"></i></div>');
                                        swal({
                                            title: 'Enter keys!',
                                            text: '<p class="lead text-muted" style="display: block;">Syntax: gameName{Delimeter}cd-key</p>'
                                            + '<textarea id="gamesToRedeemInBackground"></textarea>'
                                            + '<div class="input-group">'
                                            + '<span class="input-group-addon" id="delimeter-text">Delimeter</span>'
                                            + '<input type="text" class="form-control" id="delimeter" value="' + tmpDelimeter + '" aria-describedby="delimeter-text">'
                                            + '</div>',
                                            html: true,
                                            showCancelButton: true,
                                            confirmButtonClass: 'btn-success',
                                            confirmButtonText: 'Add keys!',
                                            closeOnConfirm: false,
                                            showLoaderOnConfirm: true
                                        }, function (isConfirm) {
                                            if (isConfirm === false) {
                                                $('.overlay').remove();
                                                return false;
                                            }
                                            var val = $('#gamesToRedeemInBackground').val();

                                            var _gamesToRedeemInBackground = {},
                                                gamesAndKeys = [],
                                                lines = val.split('\n'),
                                                currentDelimeter = $('#delimeter').val();

                                            store('delimeter', currentDelimeter);

                                            for (var i = 0; i < lines.length; i++) {
                                                if (lines[i] !== '') gamesAndKeys.push(lines[i].split(currentDelimeter));
                                            }

                                            for (var j = 0; j < gamesAndKeys.length; j++) {
                                                var obj = gamesAndKeys[j];
                                                _gamesToRedeemInBackground[obj[1]] = obj[0];
                                            }

                                            var ajaxData = { GamesToRedeemInBackground: _gamesToRedeemInBackground};

                                            $.ajax({
                                                url: '/Api/GamesToRedeemInBackground/' + encodeURIComponent(BotName),
                                                type: 'POST',
                                                data: JSON.stringify(ajaxData),
                                                contentType: 'application/json',
                                                success: function (data) {
                                                    swal({
                                                        title: 'Success!',
                                                        text: lines.length + ' Keys have been added to <' + BotName + '> background redeemer.',
                                                        type: 'success'
                                                    }, function () { location.reload(); });
                                                },
                                                error: function (jqXHR, textStatus, errorThrown) {
                                                    swal({
                                                        title: 'Error!',
                                                        text: jqXHR.status + ' - ' + errorThrown,
                                                        type: 'error'
                                                    }, function () { location.reload(); });
                                                }
                                            });

                                            $('.overlay').remove();
                                        });
                                        break;
                                }
                            })
                        }
                        
                        if (farmingIsActive) { // Add info boxes if at least one bot is farming
                            $('#totalBotOverview').html('<div class="col-md-4 col-sm-4 col-xs-12">'
                                + '<div class="info-box bot-info-box">'
                                + '<span class="info-box-icon bg-purple bots-info-box-icon"><i class="fas fa-gamepad"></i></span>'
                                + '<div class="info-box-content bot-info-box-content">'
                                + '<span class="info-box-text">Games Remaining</span>'
                                + '<span class="info-box-number" id="totalGamesRemaining"></span>'
                                + '</div>'
                                + '</div>'
                                + '</div>'
                                + '<div class="col-md-4 col-sm-4 col-xs-12">'
                                + '<div class="info-box bot-info-box">'
                                + '<span class="info-box-icon bg-green bots-info-box-icon"><i class="far fa-clock"></i></span>'
                                + '<div class="info-box-content bot-info-box-content">'
                                + '<span class="info-box-text">Time Remaining</span>'
                                + '<span class="info-box-number" id="totalTimeRemaining"></span>'
                                + '</div>'
                                + '</div>'
                                + '</div>'
                                + '<div class="col-md-4 col-sm-4 col-xs-12">'
                                + '<div class="info-box bot-info-box">'
                                + '<span class="info-box-icon bg-aqua bots-info-box-icon"><i class="far fa-clone"></i></span>'
                                + '<div class="info-box-content bot-info-box-content">'
                                + '<span class="info-box-text">Cards Remaining</span>'
                                + '<span class="info-box-number" id="totalCardsRemaining"></span>'
                                + '</div>'
                                + '</div>'
                                + '</div>');

                            totalTimeRemaining = new Date('1970-01-01T' + totalTimeRemaining + 'Z').getTime();

                            $('#totalGamesRemaining').text(totalGamesRemaining);
                            $('#totalTimeRemaining').text(humanizeDuration(totalTimeRemaining));
                            $('#totalCardsRemaining').text(totalCardsRemaining);
                        }
                    }
                });
            }
        })
    </script>
</body>
</html>
