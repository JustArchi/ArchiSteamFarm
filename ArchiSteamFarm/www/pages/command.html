<!DOCTYPE html>
<html>
<head>
    <title>ASF | Command</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script> <!--Change to cdnjs once available-->
    <link rel="icon" href="../favicon.png" type="image/png">
    <link rel="shortcut icon" href="../favicon.ico" type="img/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-sweetalert/1.0.1/sweetalert.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/2.4.2/css/AdminLTE.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <link rel="stylesheet" href="../css/_all-skins.min.css">
    <link rel="stylesheet" href="../css/app.css">
    <link rel="stylesheet" href="../css/_nightmode.min.css">
</head>
<body class="hold-transition skin-blue sidebar-mini fixed">
    <div class="wrapper">
        <header class="main-header">
            <!-- Logo -->
            <a href="javascript:void(0)" class="logo">
                <span class="logo-mini"><b>A</b>SF</span>
                <span class="logo-lg"><b>Archi</b>SteamFarm</span>
            </a>

            <!-- Header -->
            <nav class="navbar navbar-static-top" role="navigation">
                <!-- Left Sidebar Toggle Button-->
                <a href="javascript:void(0)" class="sidebar-toggle" id="leftSidebar" data-toggle="push-menu" role="button">
                    <i class="fas fa-bars"></i>
                    <span class="sr-only">Toggle navigation</span>
                </a>
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <!-- Right Sidebar Toggle Button -->
                        <li><a href="javascript:void(0)" data-toggle="control-sidebar"><i class="fas fa-cogs"></i></a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Left Sidebar -->
        <aside class="main-sidebar">
            <section class="sidebar">
                <ul class="sidebar-menu" data-widget="tree">
                    <li class="header">HOME</li>
                    <li class="active"><a href="command.html"><i class="fas fa-laptop fa-fw"></i> <span>Command</span></a></li>
                    <li>
                        <a href="bots.html">
                            <i class="fas fa-users fa-fw"></i> <span>Bots</span>
                            <span class="pull-right-container bot-status">
                                <small class="label pull-right bg-gray" id="offlineBots">0</small>
                                <small class="label pull-right bg-yellow" id="idleBots">0</small>
                                <small class="label pull-right bg-olive" id="activeBots">0</small>
                            </span>
                        </a>
                    </li>
                    <li><a href="log.html"><i class="far fa-file-alt fa-fw"></i> <span>Log</span></a></li>

                    <li class="header">CONFIG</li>
                    <li><a href="changer.html"><i class="far fa-edit fa-fw"></i> <span>Changer</span></a></li>
                    <li><a href="generator.html"><i class="far fa-copy fa-fw"></i> <span>Generator</span></a></li>

                    <li class="header">INFORMATION</li>
                    <li class="info-overview">
                        <a>
                            <i class="fas fa-tachometer-alt fa-fw"></i> <span>RAM Usage</span>
                            <span class="pull-right-container">
                                <small class="label pull-right bg-blue" id="ramUsage">0.00 MB</small>
                            </span>
                        </a>
                    </li>
                    <li class="info-overview">
                        <a>
                            <i class="far fa-clock fa-fw"></i> <span>Uptime</span>
                            <span class="pull-right-container">
                                <small class="label pull-right bg-blue" id="uptime">0d 0h 0m</small>
                            </span>
                        </a>
                    </li>
                </ul>
            </section>
        </aside>

        <div class="content-wrapper">
            <!-- Content Header -->
            <section class="content-header">
                <h1>
                    Command
                    <small>Control Panel</small>
                </h1>
                <ol class="breadcrumb">
                    <li><i class="fas fa-home"></i> Home</li>
                    <li class="active"><i class="fas fa-laptop"></i> Command</li>
                </ol>
            </section>

            <!-- Content Body -->
            <section class="content container-fluid">
                <div class="box">
                    <div class="box-header with-border">
                        <i class="fas fa-laptop"></i>
                        <h3 class="box-title">Command</h3>
                        <div class="box-tools pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown">
                                    <i class="fas fa-wrench"></i>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><button title="Toggle auto clear" type="button" class="btn btn-box-tool text-olive" id="chkAutoClear"><i id="iconAutoClear" class="fas fa-toggle-on fa-2x"></i></button>Auto clear</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="box-body">
                        <div class="box-content-command"></div>
                        <input type="text" class="form-control" id="commandSent" disabled>
                    </div>
                    <div class="box-footer">
                        <div class="input-group">
                            <div class="input-group-btn hidden-xs" id="cmdsDropDownBox">
                                <button title="Show all commands" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                    Commands
                                    <span class="fas fa-caret-down" id="iconCmdsDropDownBox"></span>
                                </button>
                                <ul class="dropdown-menu scrollable-menu" id="commandsDropDown"></ul>
                            </div>
                            <div class="input-group-btn hidden-xs" id="botsDropDownBox">
                                <button title="Show all bots" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                    Bots
                                    <span class="fas fa-caret-down" id="iconBotsDropDownBox"></span>
                                </button>
                                <ul class="dropdown-menu scrollable-menu" id="botsDropDown"></ul>
                            </div>
                            <input id="commandInput" type="text" class="form-control" placeholder="Type command...">
                            <div class="input-group-btn">
                                <button title="Send command" type="button" class="btn btn-default" id="sendCommand"><i class="far fa-paper-plane"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Footer -->
        <footer class="main-footer">
            <div class="pull-right" id="version"><b>Version</b> 0.0.0.0</div>
            <strong>
                <a href="https://github.com/JustArchi/ArchiSteamFarm">GitHub</a> -
                <a href="https://github.com/JustArchi/ArchiSteamFarm/wiki">Wiki</a> -
                <a href="https://github.com/JustArchi/ArchiSteamFarm/commits/master" id="changelog">Changelog</a>
            </strong>
        </footer>

        <!-- Right Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <div class="tab-content">
                <div class="tab-pane" id="control-right-sidebar"></div>
            </div>
        </aside>

        <div class="control-sidebar-bg"></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/interact.js/1.2.9/interact.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-sweetalert/1.0.1/sweetalert.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/2.4.2/js/adminlte.min.js"></script>
    <script src="../js/app.js"></script>
    <script>
        $(function () {
            'use strict';

            var $chkAutoClear = $('#chkAutoClear'),
                $iconAutoClear = $('#iconAutoClear'),
                $commandInput = $('#commandInput'),
                $cmdsDropDownBox = $('#cmdsDropDownBox'),
                $botsDropDownBox = $('#botsDropDownBox'),
                $iconCmdsDropDownBox = $('#iconCmdsDropDownBox'),
                $iconBotsDropDownBox = $('#iconBotsDropDownBox'),
                $botsDropDown = $("#botsDropDown"),
                $commandsDropDown = $("#commandsDropDown");
            
            var myCommands = { // For the future: Make this dynamic
                'addlicense': 'Activates given appIDs (Steam Network) or subIDs (Steam Store) on given bot instances (free games only).',
                'redeem': 'Redeems given cd-keys on given bot instances.',
                '2faok': 'Accepts all pending 2FA confirmations for given bot instances.',
                '2fa': 'Generates temporary 2FA token for given bot instances.',
                'loot': 'Sends all MatchableTypes items of given bot instances to Master user defined in their SteamUserPermissions (with lowest steamID if more than one).',
                'play': 'Switches to manual farming - launches given AppIDs on given bot instances, optionally also with custom GameName. Use !resume for returning to automatic farming.',
                'start': 'Starts given bot instances.',
                'stop': 'Stops given bot instances.',
                'pause': 'Permanently pauses automatic cards farming module of given bot instances. ASF will not attempt to farm current account in this session, unless you manually !resume it, or restart the process. Also called sticky pause.',
                'resume': 'Resumes automatic farming of given bot instances. Also see !pause, !play.',
                'restart': 'Restarts ASF process.'
            };

            var keyCount = 0,
                prevCommand = (JSON.parse(get('prevCommand')) === null) ? [] : JSON.parse(get('prevCommand'));

            $commandInput.focus();

            $('#sendCommand').click(function (e) {
                var cmd = $commandInput.val();
                keyCount = 0;

                if (typeof prevCommand[prevCommand.length - 1] === 'undefined') {
                    prevCommand.push(cmd);
                } else if (prevCommand[prevCommand.length - 1] !== cmd) {
                    prevCommand.push(cmd);
                }

                store('prevCommand', JSON.stringify(prevCommand.slice(-20))); // Only save the last 20 commands
                prevCommand = (JSON.parse(get('prevCommand')) === null) ? [] : JSON.parse(get('prevCommand'));

                sendCommand();
                e.preventDefault();
            });

            $(document).keydown(function (e) {
                if (e.which == 38 && $commandInput.is(':focus')) {
                    if (prevCommand.length > keyCount) keyCount++;
                    var index = prevCommand.length - keyCount;
                    $commandInput.val(prevCommand[index]);
                } else if (e.which == 40 && $commandInput.is(':focus')) {
                    if (keyCount > 0) keyCount--;
                    var index = prevCommand.length - keyCount;
                    $commandInput.val(prevCommand[index]);
                }
            });

            $(document).keypress(function (e) {
                if (e.which == 13 && $cmdInput.val() !== "") $('#sendCommand').click();
            });
            
            $('.box-tools').ready(function () {
                var tmpAutoClear = get('autoClear');

                if (tmpAutoClear === 'false') {
                    $chkAutoClear.removeClass('text-olive');
                    $chkAutoClear.addClass('text-grey');
                    $iconAutoClear.addClass('fa-rotate-180');
                }
            });

            $chkAutoClear.click(function () {
                if ($iconAutoClear.hasClass('fa-rotate-180')) {
                    $iconAutoClear.removeClass('fa-rotate-180');
                    $chkAutoClear.removeClass('text-grey');
                    $chkAutoClear.addClass('text-olive');
                    $chkAutoClear.blur();
                    store('autoClear', true);
                } else {
                    $iconAutoClear.addClass('fa-rotate-180');
                    $chkAutoClear.removeClass('text-olive');
                    $chkAutoClear.addClass('text-grey');
                    $chkAutoClear.blur();
                    store('autoClear', false);
                }
                return false;
            });
            
            $('.box-content-command').ready(function () {
                var tmpHeight = get('commandHeight');

                if (isNaN(tmpHeight)) {
                    $('.box-content-command').css('height', 400 + 'px');
                } else {
                    $('.box-content-command').css('height', tmpHeight + 'px');

                    if (tmpHeight > 475) {
                        $cmdsDropDownBox.addClass('dropup');
                        $botsDropDownBox.addClass('dropup');
                        $iconCmdsDropDownBox.removeClass('fa-caret-down');
                        $iconCmdsDropDownBox.addClass('fa-caret-up');
                        $iconBotsDropDownBox.removeClass('fa-caret-down');
                        $iconBotsDropDownBox.addClass('fa-caret-up');

                    } else {
                        $cmdsDropDownBox.removeClass('dropup');
                        $botsDropDownBox.removeClass('dropup');
                        $iconCmdsDropDownBox.removeClass('fa-caret-up');
                        $iconCmdsDropDownBox.addClass('fa-caret-down');
                        $iconBotsDropDownBox.removeClass('fa-caret-up');
                        $iconBotsDropDownBox.addClass('fa-caret-down');
                    }
                }
            });

            interact('.box-content-command')
                .resizable({
                    edges: { left: false, right: false, bottom: true, top: false },
                    restrictEdges: {
                        outer: 'parent',
                        endOnly: true,
                    },
                    inertia: true,
                })
                .on('resizemove', function (event) {
                    var target = event.target;
                    target.style.height = event.rect.height + 'px';
                })
                .on('resizeend', function (event) {
                    var currentHeight = parseInt(event.target.style.height, 10);
                    store('commandHeight', currentHeight);

                    if (currentHeight > 475) {
                        $cmdsDropDownBox.addClass('dropup');
                        $botsDropDownBox.addClass('dropup');
                        $iconCmdsDropDownBox.removeClass('fa-caret-down');
                        $iconCmdsDropDownBox.addClass('fa-caret-up');
                        $iconBotsDropDownBox.removeClass('fa-caret-down');
                        $iconBotsDropDownBox.addClass('fa-caret-up');
                        
                    } else {
                        $cmdsDropDownBox.removeClass('dropup');
                        $botsDropDownBox.removeClass('dropup');
                        $iconCmdsDropDownBox.removeClass('fa-caret-up');
                        $iconCmdsDropDownBox.addClass('fa-caret-down');
                        $iconBotsDropDownBox.removeClass('fa-caret-up');
                        $iconBotsDropDownBox.addClass('fa-caret-down');
                    }
                });

            $('.box-footer').ready(function () {
                $.ajax({ // Fill drop down with all bots + ASF
                    url: '/Api/Bot/ASF',
                    type: 'GET',
                    success: function (data) {
                        var json = data['Result'];

                        $botsDropDown.append('<li><a href="javascript:void(0)" onclick="fillBots(\'ASF\')">ASF</a></li><li class="divider"></li>');

                        for (var i = 0; i < json.length; i++) {
                            var obj = json[i],
                                botName = obj.BotName;

                            $botsDropDown.append('<li><a href="javascript:void(0)" onclick="fillBots(\'' + botName + '\')">' + botName + '</a></li>');
                        }
                    }
                });
                
                for (var cmd in myCommands) { // Fill drop down with all commands
                    if (myCommands.hasOwnProperty(cmd)) {
                        $commandsDropDown.append('<li><a href="javascript:void(0)" id="' + cmd + '" onclick="fillCommand(\'' + cmd + '\')">' + cmd + '</a></li>');
                        
                        $('#' + cmd)
                            .mouseenter(function () {
                                $commandInput.attr('placeholder', myCommands[this.id]); // ToDo: Find a better solution for where to display description
                            })
                            .mouseleave(function () {
                                $commandInput.attr('placeholder', 'Type command...');
                            });
                    }
                }
            });
        })
    </script>
</body>
</html>
